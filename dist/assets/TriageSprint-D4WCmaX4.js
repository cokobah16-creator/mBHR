import{u as G,d as I,e as q,r as i,f as z,G as y,j as e,g as o,h as D,i as U,k as L}from"./index-Cg81Mk6P.js";function W(){G();const{currentUser:d}=I(),v=q(),[p,T]=i.useState(null),[a,w]=i.useState(null),[x,S]=i.useState(0),[c,j]=i.useState(null),[t,k]=i.useState({correct:0,total:0,streak:0,maxStreak:0}),[n,b]=i.useState(120),[f,A]=i.useState(!1),[m,C]=i.useState(!1),u=[{id:"1",scenario:"Adult male collapsed at home",patientAge:45,patientSex:"M",symptoms:["chest pain","difficulty breathing","sweating"],vitals:{conscious:!0,breathing:!0,pulse:"weak",skinColor:"pale"},correctPriority:"urgent",explanation:"Chest pain with breathing difficulty and weak pulse suggests cardiac emergency"},{id:"2",scenario:"Child with fever and cough",patientAge:6,patientSex:"F",symptoms:["fever","cough","runny nose"],vitals:{conscious:!0,breathing:!0,pulse:"normal",skinColor:"normal"},correctPriority:"normal",explanation:"Common cold symptoms in stable child - routine care appropriate"},{id:"3",scenario:"Elderly woman with minor cut",patientAge:70,patientSex:"F",symptoms:["small laceration","no bleeding"],vitals:{conscious:!0,breathing:!0,pulse:"normal",skinColor:"normal"},correctPriority:"low",explanation:"Minor wound in stable patient can wait for routine care"},{id:"4",scenario:"Unconscious patient brought by family",patientAge:30,patientSex:"M",symptoms:["unconscious","unknown cause"],vitals:{conscious:!1,breathing:!0,pulse:"weak",skinColor:"pale"},correctPriority:"urgent",explanation:"Unconsciousness requires immediate assessment and intervention"},{id:"5",scenario:"Pregnant woman with contractions",patientAge:28,patientSex:"F",symptoms:["regular contractions","back pain"],vitals:{conscious:!0,breathing:!0,pulse:"strong",skinColor:"normal"},correctPriority:"urgent",explanation:"Active labor requires immediate obstetric care"}];i.useEffect(()=>{if(f&&n>0&&!m){const s=setTimeout(()=>b(n-1),1e3);return()=>clearTimeout(s)}else n===0&&!m&&P()},[f,n,m]);const $=async()=>{if(d)try{const s=[...u].sort(()=>Math.random()-.5).slice(0,3),r=await y.startSession("triage",d.id,{totalCases:s.length,startTime:new Date().toISOString()});T(r),w(s[0]),S(0),A(!0),b(120),k({correct:0,total:0,streak:0,maxStreak:0}),j(null),C(!1)}catch(s){console.error("Error starting triage sprint:",s)}},P=async()=>{if(!a||!p)return;const s=c===a.correctPriority,r={...t,total:t.total+1,correct:t.correct+(s?1:0),streak:s?t.streak+1:0,maxStreak:Math.max(t.maxStreak,s?t.streak+1:t.streak)};k(r),setTimeout(()=>{x<u.length-1?(S(x+1),w(u[x+1]),j(null),b(120)):M()},2e3)},M=async()=>{if(!(!p||!d))try{C(!0);const s=t.total>0?t.correct/t.total:0,r=n>30?1.1:1,g=t.maxStreak>=3?1.2:1,N=await z.gamificationWallets.get(d.id),F=y.calculateTokens(15,{accuracy:s,streak:(N==null?void 0:N.streakDays)||0,speedBonus:r,qualityBonus:g});await y.completeSession(p.id,{score:Math.round(s*100),tokensEarned:F,badges:[],multipliers:{accuracy:s,speed:r,quality:g}}),setTimeout(()=>{v("/games")},5e3)}catch(s){console.error("Error ending game:",s)}},R=s=>{const r=Math.floor(s/60),g=s%60;return`${r}:${g.toString().padStart(2,"0")}`},B=s=>{switch(s){case"urgent":return"bg-red-500 hover:bg-red-600 text-white";case"normal":return"bg-yellow-500 hover:bg-yellow-600 text-white";case"low":return"bg-green-500 hover:bg-green-600 text-white"}},E=s=>{switch(s){case"urgent":return"🚨";case"normal":return"⚠️";case"low":return"✅"}};if(!f)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(o,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Triage Sprint"}),e.jsx("p",{className:"text-gray-600",children:"Quick priority assessment challenges"})]})]}),e.jsx("div",{className:"card max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{className:"h-16 w-16 mx-auto text-orange-500 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Ready for Triage Training?"}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"text-sm text-orange-800",children:[e.jsx("div",{className:"font-medium mb-2",children:"🚨 Challenge Rules:"}),e.jsxs("ul",{className:"text-xs space-y-1 text-orange-700 text-left",children:[e.jsx("li",{children:"• 3 random patient scenarios"}),e.jsx("li",{children:"• 2 minutes per case to assess priority"}),e.jsx("li",{children:"• +15 tokens per correct triage decision"}),e.jsx("li",{children:"• +20% bonus for 3-case streak"}),e.jsx("li",{children:"• +10% speed bonus if time remaining"}),e.jsx("li",{children:"• Focus: ABC assessment and priority"})]})]})}),e.jsx("button",{onClick:$,className:"btn-primary",children:"Start Triage Sprint"})]})})]});if(m){const s=Math.round(t.correct/t.total*100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(o,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Triage Sprint Complete!"}),e.jsx("p",{className:"text-gray-600",children:"Excellent work on patient prioritization!"})]})]}),e.jsx("div",{className:"card max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:s>=80?"🏆":s>=60?"🥈":"🥉"}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[t.correct,"/",t.total]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-orange-600",children:[s,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:t.maxStreak}),e.jsx("div",{className:"text-sm text-gray-600",children:"Max Streak"})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-green-800 font-medium",children:"🎉 Session completed! Waiting for supervisor approval to mint tokens."})}),e.jsx("button",{onClick:()=>v("/games"),className:"btn-primary",children:"Back to Game Hub"})]})})]})}if(!a)return null;const h=c!==null,l=c===a.correctPriority;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(o,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Triage Sprint"}),e.jsxs("p",{className:"text-gray-600",children:["Case ",x+1," of ",u.length]})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[t.correct,"/",t.total]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.streak}),e.jsx("div",{className:"text-sm text-gray-600",children:"Streak"})]}),e.jsxs("div",{className:"text-center flex items-center space-x-1",children:[e.jsx(D,{className:"h-5 w-5 text-red-500"}),e.jsx("div",{className:`text-2xl font-bold ${n<=30?"text-red-600 animate-pulse":"text-red-600"}`,children:R(n)})]})]})]}),e.jsx("div",{className:"card max-w-4xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Patient Presentation"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(U,{className:"h-6 w-6 text-blue-600"}),e.jsx("div",{children:e.jsxs("p",{className:"font-medium text-blue-800",children:[a.patientAge," year old ",a.patientSex==="M"?"male":"female"]})})]}),e.jsx("p",{className:"text-blue-700 text-lg",children:a.scenario})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Symptoms"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.symptoms.map((s,r)=>e.jsx("span",{className:"px-3 py-2 bg-gray-100 text-gray-800 rounded-full text-sm font-medium",children:s},r))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Quick Assessment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Conscious:"}),e.jsx("span",{className:`text-sm font-bold ${a.vitals.conscious?"text-green-600":"text-red-600"}`,children:a.vitals.conscious?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Breathing:"}),e.jsx("span",{className:`text-sm font-bold ${a.vitals.breathing?"text-green-600":"text-red-600"}`,children:a.vitals.breathing?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pulse:"}),e.jsx("span",{className:"text-sm font-bold capitalize",children:a.vitals.pulse})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Skin Color:"}),e.jsx("span",{className:"text-sm font-bold capitalize",children:a.vitals.skinColor})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Assign Priority"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Based on the patient presentation, what priority should this case receive?"})]}),e.jsx("div",{className:"space-y-4",children:["urgent","normal","low"].map(s=>e.jsx("button",{onClick:()=>j(s),disabled:h,className:`w-full p-6 rounded-xl border-2 transition-all touch-target-large ${c===s?`${B(s)} ring-2 ring-primary/20`:"bg-white border-gray-200 hover:border-gray-300"} ${h?"cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-4xl",children:E(s)}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-xl font-bold capitalize",children:s}),e.jsxs("div",{className:"text-sm opacity-90",children:[s==="urgent"&&"Immediate attention required",s==="normal"&&"Standard care pathway",s==="low"&&"Can wait for routine care"]})]})]})},s))}),e.jsx("div",{className:"text-center pt-4",children:e.jsx("button",{onClick:P,disabled:!c||h,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"Submit Priority Decision"})}),h&&e.jsxs("div",{className:`p-4 rounded-lg border ${l?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[l?e.jsx(L,{className:"h-5 w-5 text-green-600"}):e.jsx(o,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:`font-medium ${l?"text-green-800":"text-red-800"}`,children:l?"Correct!":"Incorrect"})]}),e.jsxs("p",{className:`text-sm ${l?"text-green-700":"text-red-700"}`,children:[e.jsx("strong",{children:"Correct Priority:"})," ",a.correctPriority]}),e.jsx("p",{className:`text-sm mt-2 ${l?"text-green-700":"text-red-700"}`,children:a.explanation})]})]})]})})]})}export{W as default};
