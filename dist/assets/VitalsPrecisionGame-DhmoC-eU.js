import{u as H,d as I,e as _,r as o,f as D,G as S,j as e,l as j,h as L,k as U,m as W}from"./index-Cg81Mk6P.js";function z(){H();const{currentUser:h}=I(),b=_(),[f,B]=o.useState(null),[l,w]=o.useState(null),[m,k]=o.useState(0),[N,C]=o.useState({}),[t,A]=o.useState({correct:0,total:0,streak:0,maxStreak:0}),[d,R]=o.useState(300),[v,F]=o.useState(!1),[p,$]=o.useState(!1),x=[{id:"1",patientAge:35,patientSex:"M",scenario:"Adult male presenting with chest pain",vitals:{hr:110,temp:37.2,sbp:150,dbp:95,rr:22,spo2:97},normalRanges:{hr:[60,100],temp:[36.1,37.2],sbp:[90,140],dbp:[60,90],rr:[12,20],spo2:[95,100]}},{id:"2",patientAge:8,patientSex:"F",scenario:"Child with fever and cough",vitals:{hr:130,temp:39.1,sbp:95,dbp:60,rr:28,spo2:95},normalRanges:{hr:[80,120],temp:[36.1,37.2],sbp:[85,110],dbp:[50,70],rr:[20,30],spo2:[95,100]}},{id:"3",patientAge:65,patientSex:"F",scenario:"Elderly woman routine check",vitals:{hr:72,temp:36.8,sbp:135,dbp:85,rr:16,spo2:98},normalRanges:{hr:[60,100],temp:[36.1,37.2],sbp:[90,140],dbp:[60,90],rr:[12,20],spo2:[95,100]}},{id:"4",patientAge:25,patientSex:"M",scenario:"Young athlete post-exercise",vitals:{hr:95,temp:37,sbp:120,dbp:75,rr:18,spo2:99},normalRanges:{hr:[60,100],temp:[36.1,37.2],sbp:[90,140],dbp:[60,90],rr:[12,20],spo2:[95,100]}},{id:"5",patientAge:45,patientSex:"F",scenario:"Woman with headache",vitals:{hr:88,temp:36.5,sbp:165,dbp:100,rr:20,spo2:98},normalRanges:{hr:[60,100],temp:[36.1,37.2],sbp:[90,140],dbp:[60,90],rr:[12,20],spo2:[95,100]}}];o.useEffect(()=>{if(v&&d>0&&!p){const s=setTimeout(()=>R(d-1),1e3);return()=>clearTimeout(s)}else d===0&&!p&&M()},[v,d,p]);const G=async()=>{if(h)try{const s=[...x].sort(()=>Math.random()-.5),a=await S.startSession("vitals",h.id,{totalCases:s.length,startTime:new Date().toISOString()});B(a),w(s[0]),k(0),F(!0),R(300),A({correct:0,total:0,streak:0,maxStreak:0}),C({}),$(!1)}catch(s){console.error("Error starting vitals precision game:",s)}},E=async(s,a)=>{if(!l||!f)return;const r=P(l,s,a),n={...N,[`${l.id}_${s}`]:a};C(n);const c={...t,total:t.total+1,correct:t.correct+(r?1:0),streak:r?t.streak+1:0,maxStreak:Math.max(t.maxStreak,r?t.streak+1:t.streak)};A(c);const i=Object.keys(l.vitals);i.filter(u=>n[`${l.id}_${u}`]).length===i.length&&setTimeout(()=>{m<x.length-1?(k(m+1),w(x[m+1])):M()},1500)},P=(s,a,r)=>{const n=s.vitals[a];if(!n)return!1;const c=s.normalRanges[a];if(!c)return!1;const i=n>=c[0]&&n<=c[1];return r==="normal"===i},M=async()=>{if(!(!f||!h))try{$(!0);const s=t.total>0?t.correct/t.total:0,a=d>60?1.1:1,r=t.maxStreak>=8?1.2:1,n=await D.gamificationWallets.get(h.id),c=S.calculateTokens(12,{accuracy:s,streak:(n==null?void 0:n.streakDays)||0,speedBonus:a,qualityBonus:r});await S.completeSession(f.id,{score:Math.round(s*100),tokensEarned:c,badges:[],multipliers:{accuracy:s,speed:a,quality:r}}),setTimeout(()=>{b("/games")},5e3)}catch(s){console.error("Error ending game:",s)}},O=s=>{const a=Math.floor(s/60),r=s%60;return`${a}:${r.toString().padStart(2,"0")}`};if(!v)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Vitals Precision"}),e.jsx("p",{className:"text-gray-600",children:"Enhanced vital signs validation training"})]})]}),e.jsx("div",{className:"card max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"h-16 w-16 mx-auto text-green-500 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Ready for Enhanced Training?"}),e.jsxs("div",{className:"space-y-4 text-left max-w-md mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:"1"})}),e.jsxs("p",{className:"text-gray-700",children:["Review ",x.length," patient scenarios with age/sex context"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:"2"})}),e.jsx("p",{className:"text-gray-700",children:"Identify normal vs abnormal vital signs using clinical ranges"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:"3"})}),e.jsx("p",{className:"text-gray-700",children:"Earn tokens based on accuracy, speed, and streak performance"})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("div",{className:"font-medium mb-1",children:"ðŸ’¡ Enhanced Scoring:"}),e.jsxs("ul",{className:"text-xs space-y-1 text-green-700",children:[e.jsx("li",{children:"â€¢ Base: 12 tokens"}),e.jsx("li",{children:"â€¢ Accuracy bonus: up to +30%"}),e.jsx("li",{children:"â€¢ Speed bonus: +10% if 1+ minute remaining"}),e.jsx("li",{children:"â€¢ Streak bonus: +20% for 8+ correct in a row"}),e.jsx("li",{children:"â€¢ Age/sex-specific normal ranges"})]})]})}),e.jsx("button",{onClick:G,className:"btn-primary",children:"Start Enhanced Vitals Precision"})]})})]});if(p){const s=Math.round(t.correct/t.total*100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Vitals Precision Complete!"}),e.jsx("p",{className:"text-gray-600",children:"Excellent work on clinical assessment!"})]})]}),e.jsx("div",{className:"card max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:s>=90?"ðŸ†":s>=75?"ðŸ¥ˆ":"ðŸ¥‰"}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-primary",children:[t.correct,"/",t.total]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold text-orange-600",children:[s,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:t.maxStreak}),e.jsx("div",{className:"text-sm text-gray-600",children:"Max Streak"})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-green-800 font-medium",children:"ðŸŽ‰ Enhanced session completed! Waiting for supervisor approval to mint tokens."})}),e.jsx("button",{onClick:()=>b("/games"),className:"btn-primary",children:"Back to Game Hub"})]})})]})}if(!l)return null;const g=Object.keys(l.vitals),y=g.filter(s=>N[`${l.id}_${s}`]),V=y.length/g.length*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Vitals Precision"}),e.jsxs("p",{className:"text-gray-600",children:["Case ",m+1," of ",x.length]})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[t.correct,"/",t.total]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.streak}),e.jsx("div",{className:"text-sm text-gray-600",children:"Streak"})]}),e.jsxs("div",{className:"text-center flex items-center space-x-1",children:[e.jsx(L,{className:"h-5 w-5 text-red-500"}),e.jsx("div",{className:`text-2xl font-bold ${d<=60?"text-red-600 animate-pulse":"text-red-600"}`,children:O(d)})]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-primary h-3 rounded-full transition-all duration-300",style:{width:`${V}%`}})}),e.jsxs("div",{className:"card max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Patient Scenario"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("p",{className:"text-blue-800",children:[e.jsx("strong",{children:"Age:"})," ",l.patientAge," years old â€¢",e.jsx("strong",{children:"Sex:"})," ",l.patientSex==="M"?"Male":"Female"]}),e.jsx("p",{className:"text-blue-700 mt-2",children:l.scenario})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(l.vitals).map(([s,a])=>{const r=N[`${l.id}_${s}`],n=l.normalRanges[s],c=a>=n[0]&&a<=n[1],i=r&&r==="normal"===c,T={hr:"Heart Rate",temp:"Temperature",sbp:"Systolic BP",dbp:"Diastolic BP",rr:"Respiratory Rate",spo2:"SpO2"},u={hr:"bpm",temp:"Â°C",sbp:"mmHg",dbp:"mmHg",rr:"/min",spo2:"%"};return e.jsxs("div",{className:`border rounded-lg p-4 transition-all ${r?i?"border-green-200 bg-green-50":"border-red-200 bg-red-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:T[s]}),e.jsxs("div",{className:"text-4xl font-bold text-primary mt-2",children:[a,e.jsx("span",{className:"text-lg text-gray-600 ml-1",children:u[s]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Normal: ",n[0],"-",n[1]," ",u[s]]})]}),r?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i?e.jsx(U,{className:"h-5 w-5 text-green-600"}):e.jsx(W,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{className:`text-sm font-medium capitalize ${i?"text-green-700":"text-red-700"}`,children:[r," ",i?"âœ“":"âœ—"]})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>E(s,"normal"),className:"flex-1 bg-green-100 text-green-800 py-3 px-4 rounded-lg hover:bg-green-200 transition-colors font-medium touch-target-large",children:"Normal"}),e.jsx("button",{onClick:()=>E(s,"abnormal"),className:"flex-1 bg-red-100 text-red-800 py-3 px-4 rounded-lg hover:bg-red-200 transition-colors font-medium touch-target-large",children:"Abnormal"})]})]},s)})}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[y.length," of ",g.length," vitals assessed"]}),y.length===g.length&&m<x.length-1&&e.jsx("p",{className:"text-sm text-green-600 mt-2",children:"âœ… Case complete! Moving to next case..."})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>b("/games"),className:"btn-secondary",children:"Cancel Game"})})]})}export{z as default};
